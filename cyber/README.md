## structure
- micro test：simple_s/
- ADSBench test：detect_s/
- data format：test.proto

## Init
### Reference
- [docs](https://github.com/ApolloAuto/apollo/tree/master/cyber)
- [launch-the-component](https://github.com/ApolloAuto/apollo/blob/master/docs/cyber/CyberRT_Quick_Start.md#launch-the-component)
- [cyber container start](https://github.com/ApolloAuto/apollo/blob/master/docs/cyber/CyberRT_Docker.md)
- [cyber blog in CSDN](https://blog.csdn.net/qq_25762163/category_9599333.html)
### Step by Step
1. clone the [project](https://github.com/ApolloAuto/apollo.git) from git
2. checkout to r5.5.0[docs of 2,3,4 steps](https://github.com/ApolloAuto/apollo/blob/master/docs/quickstart/apollo_software_installation_guide.md#Set-up-the-Docker-environment)
3. sudo groupadd docker, sudo usermod -aG docker $USER # this can make docker run without sudo, however when running the cyber script you may still need sudo
4. echo "export APOLLO_HOME=$(pwd)" >> ~/.bashrc && source ~/.bashrc
5. follow the doc of cyber to run docker/script/cyber_start.sh & cyber_into.sh
6. the build in cyber is ./apollo.sh build_cyber(must as root), remember not to use build since it will build other modules and will fail. And keep in mind to allocate enough memory for cyber container(32G is recommended), or the build process may fail.
### Enter into cyber container and init the environment：
- run in root: docker exec -u root -it [container num] /bin/bash  
- init environment: source /apollo/cyber/setup.bash（important, or you cannot use cyber_* commands）

## micro test：
### 1to1,1toN,Nto1...
### how to use：
- S.cc is a Timer，it sends a msg every intervel ms，C.cc is the Receiver，it receives msg from S.cc and record the transfer time.
- 1t1: ./run1t1.sh \[1t1_t or 1t1_p\] \[index\] \[msg size\]
- 1tn: 

### for developer
- S.cc reads the msg size and channel topic name from param\[S's node name\].txt which is generated by run.sh（example: 1024 c0，means 1024byte per msg，published in c0 topic），the publish frequency is defined in the field "interval" in .dag，units ms；the topic name that C.cc subscribes is defined in .dag，set the field: readers.channel to /c0 could receive msg from c0，if C is to receive from multi-channels, you need to change C's class struct and related Proc，see C.cc，and .dag needs changes too.
- before running：customize .dag, if communicate between threads（using intra）, put S and C in one dag，different process should be in different dag；then create a .launch file to use these dags, then customize a .conf file for each process with "process_name" in .launch；if you change some code in cyber, recompile in /apollo by running `./apollo.sh build_cyber`
- after running one script，it will create some param\[\*\].txt，then copy some files like 1t1*.conf to /apollo/cyber/conf/, finally it will run \*.launch to start.
- the results are stored in /apollo/data/log/test/tmp，each topic subscribed by each subscriber will have a record file，it is recommended to move the recording files to another place once you finised a round since at the beginning of each round the recording file directory will be cleared.
## Detect_s：
- YoloDetect.cc,Line.cc,CameraTimer.cc,TrackerApollo.cc,FusionFinal.cc, CameraTimer generates data，YoloDetect\Line\TrackerApollo handle the data，the results are fused by FusionFinal. The data formats are defined in detect_msg.proto
- TODO
